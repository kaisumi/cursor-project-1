# ADR-0005: 開発環境でのRailsサーバーのローカル実行

## ステータス
承認

## コンテキスト
開発環境の構築において、RailsサーバーをDockerコンテナ内で実行するか、ローカル環境で実行するかの選択が必要でした。当初はDockerコンテナ内での実行を検討していましたが、開発効率とデバッグのしやすさを考慮して、ローカル環境での実行に方針を変更する必要が生じました。

## 決定
開発環境では、以下の構成を採用します：

1. コンテナ化するもの：
   - PostgreSQL（データベース）
   - Redis（キャッシュ、ジョブキュー）
   - Mailcatcher（メール送信のテスト）
   - Sidekiq（バックグラウンドジョブ）

2. ローカルで実行するもの：
   - Railsサーバー
   - Tailwind CSS（アセットの監視）

## 実装方針
1. `docker-compose.yml`からRailsサーバー関連の設定を削除し、Sidekiqの設定を追加
2. `Procfile.dev`を更新して、Sidekiqを除外
3. 開発環境の起動手順を更新：
   ```bash
   # コンテナの起動
   docker compose up -d
   
   # ローカルでのRailsサーバー起動
   bin/dev
   ```

## 結果
### ポジティブな影響
1. デバッガー（byebug, debugger, pry等）が直接使用可能
2. コードの変更が即時反映される（ホットリロード）
3. ログの確認が容易
4. 開発時のパフォーマンスが向上
5. 開発環境の起動が高速化
6. Sidekiqの処理状況の監視が容易
7. 本番環境に近い形でバックグラウンドジョブをテスト可能

### ネガティブな影響
1. 開発環境のセットアップが若干複雑化（Rubyのインストールが必要）
2. チームメンバー間で環境の差異が生じる可能性
3. コンテナ環境との完全な一致が保証されない

## 代替案
1. **完全なコンテナ化**
   - メリット：環境の一貫性が保証される
   - デメリット：デバッグが困難、開発効率が低下

2. **開発用の特別なDocker設定**
   - メリット：環境の一貫性を保ちながらデバッグも可能
   - デメリット：設定が複雑化、パフォーマンスのオーバーヘッド

3. **VSCode Dev Containersの使用**
   - メリット：IDEとの統合が容易
   - デメリット：追加の設定が必要、チーム全員がVSCodeを使用する必要がある

これらの代替案は、開発効率とデバッグのしやすさを考慮した結果、採用を見送りました。 