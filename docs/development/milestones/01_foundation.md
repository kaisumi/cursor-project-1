# マイルストーン1: 基盤構築
期間: 2024-04-30 ~ 2024-05-01

## 🎯 目標
- 開発環境の整備
- 基本的なユーザー認証の実装
- プロジェクトの基本構造の確立

## 📋 タスク一覧

### 1. 開発環境セットアップ [ENV-001]
- [x] Docker環境の構築
    - ベースイメージ: ruby:3.2.x
    - 必要なサービス: PostgreSQL, Redis
    - メールサーバー: Mailcatcher
- [x] VSCode設定
    - 必要な拡張機能: Ruby, Rails, Docker
    - 推奨設定の適用
- [x] git-flowの設定
    - ブランチ命名規則の確立
    - コミットメッセージ規約の設定

### 2. データベース設計 [DB-001]
- [x] マイグレーションファイルの作成
    ```ruby
    # 実装例
    create_table :users do |t|
      t.string :email, null: false
      t.string :name
      t.timestamps
    end
    ```
- [x] シードデータの準備
    - テスト用ユーザーの作成
    - 基本的な設定値の投入

### 3. 認証機能の実装 [AUTH-001]
- [x] パスワードレス認証の基本実装
    - Deviseの導入と設定
      ```ruby
      # Gemfile
      gem 'devise'
      gem 'letter_opener'
      ```
    - メール送信機能
      - UserPasswordlessMailerの実装
      - メールテンプレートの作成
      - 開発環境でのメール送信テスト
    - トークン生成ロジック
      - セキュアなトークン生成
      - トークンの有効期限管理（30分）
      - トークンの検証
    - セッション管理
      - セッションコントローラーの実装
      - セッションの作成と検証
      - セッションタイムアウト（24時間）
- [x] 基本的なエラーハンドリング
    - バリデーション
      - メールアドレスの形式チェック
      - トークンの有効性チェック
      - レート制限（1時間あたり5回まで）
    - エラーメッセージ
      - フラッシュメッセージの実装
      - エラーページの作成
      - ユーザーフレンドリーなメッセージ
    - ログ出力
      - 認証関連のログ出力
      - エラーログの出力
      - 監視と通知の設定

### 4. テスト環境の整備 [TEST-001]
- [x] RSpecの設定
    - 基本的な設定
      - RSpecの初期化
      - 設定ファイルの作成
      - テストヘルパーの準備
    - ファクトリの作成
      - ユーザーファクトリ
      - 認証関連のファクトリ
      - Post/Commentファクトリ
    - ヘルパーの準備
      - テストヘルパー
      - カスタムマッチャー
      - 認証関連のヘルパー
- [x] テストカバレッジの設定
    - SimpleCovの導入
      - SimpleCovの設定
      - カバレッジレポートの設定
      - 除外設定の追加
      - カバレッジ目標の設定（90%以上）
    - coverage 89.55%（今後追加テストで90%以上を目指す）

### 5. CI/CDの基本設定 [CI-001]
- [ ] GitHub Actionsの設定
    - 基本的なワークフローの作成
      - テスト実行
      - 静的解析
      - セキュリティスキャン
    - テストの自動実行
      - RSpecの実行
      - カバレッジレポートの生成
      - テスト結果の通知
    - 静的解析の設定
      - Rubocop
      - ESLint
      - Brakeman
- [ ] デプロイメント設定
    - ステージング環境の設定
      - 環境変数の設定
      - データベース設定
      - メール設定
    - デプロイスクリプトの作成
      - デプロイ手順の自動化
      - ロールバック手順の作成
      - 監視設定

## 📊 進捗管理
- タスクの完了状況
  - ✅ 開発環境セットアップ [ENV-001]
  - ✅ データベース設計 [DB-001]
  - ✅ 認証機能の実装 [AUTH-001]（完了）
  - ✅ テスト環境の整備 [TEST-001]（完了）
  - ⏳ CI/CDの基本設定 [CI-001]（未着手）
- リスクの管理
  - Docker環境の構築に問題が発生する可能性
  - データベース設計の変更が必要になる可能性
  - 認証機能の実装に時間がかかる可能性
  - テスト環境の設定に問題が発生する可能性
- 課題の追跡
  - テスト環境の整備計画の策定が必要
  - CI/CDの基本設定計画の策定が必要
  - 認証機能の拡張計画の策定が必要

## 🔍 レビューポイント
- セキュリティ要件の充足
  - 認証機能のセキュリティ
    - パスワードレス認証の実装
    - トークンのセキュリティ
    - セッション管理の安全性
    - レート制限の実装
  - データベースのセキュリティ
    - データの暗号化
    - アクセス制御
  - 環境変数の管理
    - 機密情報の保護
    - 環境ごとの設定
- パフォーマンス要件の充足
  - データベースのパフォーマンス
    - インデックスの最適化
    - クエリの最適化
  - アプリケーションのレスポンス
    - キャッシュの活用
    - 非同期処理の実装
  - テストの実行時間
    - テストの並列実行
    - テストデータの最適化
- コード品質の確保
  - コーディング規約の遵守
    - Ruby Style Guide
    - Rails Style Guide
  - テストカバレッジ
    - ユニットテスト
    - 統合テスト
  - ドキュメントの完全性
    - APIドキュメント
    - 開発者ガイド
    - 運用マニュアル 